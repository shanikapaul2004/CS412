<!--
    file: show_feed.html
    name: Shanika Paul
    email: shanikap@bu.edu
    date: October 19, 2025
    description: Template to display the post feed for a profile (posts from profiles they follow).
-->

{% extends 'mini_insta/base.html' %}

{% block content %}
<h2>Feed for {{ profile.username }}</h2>

<main style="max-width: 800px; margin: 20px auto;">
    
    <!-- for the nav buttons on top -->
    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; border: 1px solid #dbdbdb;">
        <a href="{% url 'show_profile' profile.pk %}" 
           style="background-color: #0095f6; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600;">
            üë§ Profile
        </a>
        <a href="{% url 'show_all_profiles' %}" 
           style="background-color: #dbdbdb; color: #262626; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600;">
            üè† All Profiles
        </a>
    </div>
    
    <!-- feed for posts -->
    {% if posts %}
        {% for post in posts %}
        <article style="background: white; border: 1px solid #dbdbdb; border-radius: 8px; margin-bottom: 20px; padding: 0; overflow: hidden;">
            
            <!-- header of the post with profile information -->
            <div style="display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #dbdbdb;">
                <img src="{{ post.profile.profile_image_url }}" alt="{{ post.profile.username }}" 
                     style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                <div>
                    <a href="{% url 'show_profile' post.profile.pk %}" style="text-decoration: none; color: #262626;">
                        <strong>{{ post.profile.username }}</strong>
                    </a>
                    <p style="margin: 0; font-size: 12px; color: #8e8e8e;">{{ post.profile.display_name }}</p>
                </div>
            </div>
            
            <!-- first photo of the post  -->
            {% if post.get_all_photos.first %}
            <a href="{% url 'show_post' post.pk %}">
                <img src="{{ post.get_all_photos.first.get_image_url }}" alt="Post image" 
                     style="width: 100%; display: block;">
            </a>
            {% endif %}
            
            <!-- details of the post  -->
            <div style="padding: 15px;">
                <!-- all the likes-->
                <div style="margin-bottom: 10px;">
                    <strong>{{ post.get_likes.count }} likes</strong>
                </div>
                
                <!-- presenting captions  -->
                <div style="margin-bottom: 10px;">
                    <strong>{{ post.profile.username }}</strong> {{ post.caption }}
                </div>
                
                <!-- previewing the captions -->
                {% if post.get_all_comments %}
                <div style="margin-bottom: 10px;">
                    <a href="{% url 'show_post' post.pk %}" style="color: #8e8e8e; text-decoration: none;">
                        View all {{ post.get_all_comments.count }} comments
                    </a>
                    
                    <!-- first comment display -->
                    {% with post.get_all_comments.first as first_comment %}
                    <p style="margin: 5px 0;">
                        <strong>{{ first_comment.profile.username }}</strong> {{ first_comment.text|truncatewords:10 }}
                    </p>
                    {% endwith %}
                </div>
                {% endif %}
                
                <!-- timestamp -->
                <small style="color: #8e8e8e;">{{ post.timestamp|date:"M d, Y" }}</small>
            </div>
        </article>
        {% endfor %}
    {% else %}
        <div style="background: white; border: 1px solid #dbdbdb; border-radius: 8px; padding: 40px; text-align: center;">
            <h3 style="color: #8e8e8e;">No posts in your feed yet!</h3>
            <p style="color: #8e8e8e;">Follow some profiles to see their posts here.</p>
            <a href="{% url 'show_all_profiles' %}" 
               style="background-color: #0095f6; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-block; margin-top: 20px;">
                Discover Profiles
            </a>
        </div>
    {% endif %}
</main>
{% endblock %}